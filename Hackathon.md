# Determined write-up

> TLDR: We teach our GPUs to bust Malware!!

## Introduction

In this project we explore the capability of ML to detect Malware.
### In-Memory

The first step focuses on the detection of malware in memory dumps.

Malware often resides in the memory of a computer to avoid detection from anti-virus software.
The memory dump is a snapshot of the memory of a computer at a given time.

Since this is boring tabular data, we normalize the numeric columns and use a simple MLP to classify the data.
Once training the MLP yields success, we move to the coolest trend of the century: `throw transformers at everything` üèåüèΩ‚Äç‚ôÇÔ∏è

## Network data and Graph Convolutions

In a second step we focus on network data.
This step requires more prior worq since curated datasets are not available.
The approach is to gather `pcaps` from incidents, extract the network data with [zeek](https://www.zeek.org/), and label the data according to the incident.

From here on we can build a graph dataset using the IP addresses as nodes and the network traffic as edges.

Now the power of Graph Convolutions can be fully released ‚ù§Ô∏è‚Äçüî•

## Determined AI

The author of this repo dreamfully wishes to have had access to the [Determined AI](https://determined.ai/) platform during this thesis-project.  

[Determined AI](https://determined.ai/) enables distributed training and hyperparameter search/tuning, while adding minimal overhead.

### Ode 2 Determined AI

> A homenage to the [Determined AI](https://determined.ai/) platform.

The following are cherry-picked screenshots of the Determined UI during the experiments of this project.
The descriptions are of both explanatory and insightful nature. Written in colabotratio with [Captain Obvious](https://www.slashfilm.com/wp/wp-content/images/Captain-Hook.jpg).

<!-- You can save your model and corresponding checkpoints. That's pretty cool! -->
<!-- ![model_overview](https://user-images.githubusercontent.com/25290565/232586537-7b8aec55-62a9-4b15-8443-b4e9f2fc79b8.png) -->

## The Core Api

The core api offers us extended flexibility, on the costs that it is slightly more complicated to set up.

The first view shows the validation loss over epochs.
Here we can see how our model overfits on out dataset.
Obviously it should go down correlating with the training loss.
![overfitting](https://user-images.githubusercontent.com/25290565/232586881-4487c583-9a78-4292-9d4b-bdc21b577c8f.png)

Arguably the most valuable plot are the hyperparameter plots over validation loss.
The versus plots help us to easily detect the better params. 
Dropout is a special case as a high dropout might need more epochs to proof beneficial.
![vs_plots](https://user-images.githubusercontent.com/25290565/232587060-0ff5456b-f1ce-422e-a067-004d0eed9f35.png)

The hyperparameter search space is my favorite!! I always wanted to play around with these filters on my own model.
![search_space](https://user-images.githubusercontent.com/25290565/232587415-d954a776-915d-4916-9f98-3eae52c6da06.png)


The classic confusion matrix. The heatmap makes this the most appealing plot!
Personally is scores second on the added-value scale.
Undoubtfully it will benefit from more runs aka more data-points.
It would be cool to be able to drag-drop them around to change the position of the plots.
![confusion](https://user-images.githubusercontent.com/25290565/232587592-5d22fb40-d5d9-454b-87b1-81c6f042bc33.png)

## PytorchTiral 

This is the easy-going way which also lets you register your model on the Determined UI.
For this experiment we set `normalization` and the granularity of the labels as searchable hyperparameter.

Again, the beautiful search space, this time with even more hyper-parameters. 
Results show that not normalizing does not hurt the binary classification.
![search_space](https://user-images.githubusercontent.com/25290565/232587948-4e3e67ad-47b4-41ce-a441-dbb193d790f4.png)

The vs plots, always a win:
![vs_plots](https://user-images.githubusercontent.com/25290565/232588634-904c368f-3d6b-46c9-88d6-b6bc7617b2fc.png)

The confusion matrix seems to not work for values of different types, such as float and bool.
The author of this repo considers opening a feature request for this.
![confusion_bug](https://user-images.githubusercontent.com/25290565/232587919-46df7ba7-67e1-40f6-b586-ea52beaa5008.png)

Finally the model hub. 
Only thing missing here is a hotlink to upload our model to huggingface ü§ó
![model_overview](https://user-images.githubusercontent.com/25290565/232589049-989fa22f-2193-4982-94df-388092dfe5ba.png)

## Accomplishments 

While it took a couple hours of deep-diving into the Determined Documentation, we are proud to have set up the Cluster locally with both Docker and Kubernetes.
This sets us up for a whole new type of ML meetups where everyone brings the GPU along, connects to the local network and participates in hyperparameter-search.

A working `docker-compose.yml` is included in the projects repo.

## What's next for Determined Hunter

1. step-one: Objective Secure ‚úÖ
2. step-two: engaging target üéØ

Step one of detecting malware in memory dumps has been a success!

We move on to unchartered territory and engage with networq data. Always on the hunt for bad-guys!

## Acknowledgements

Thanq you Determined AI team for this flabbergasting platform! ü§çüêßü§ç
Stay secure!
